---
layout: post
title: ! 'WAP: Step 1'
tags: []
status: publish
type: post
published: true
meta: {}
---
<p>WAP/WML -First things first.</p>

<p>Having stumbled across a few articles relating to WAP and WML recently (yes I know I am slightly behind the times) I decided to have a play with WAP devices and WML, i.e. make this web site accessible to WAP devices. So after thinking about what approach to take I decided that the first thing I needed to figure out was how to re-direct a user to the appropriate page based on the browser they use to make sure the information was rendered properly. So I set out writing a browser re-direction script that would accommodate both normal web users (IE and Netscape), Nokia 6210 (since this is the mobile I own) and iTV (with several projects in the pipeline I figured this was as good time as ever to figure that one out too), but that will form part of a segment which you can have a look at <a href="">here</a>.</p>

<p>The first thing you will need before you an even start building the script would be a set of tools so that you can test your script and pages. Nokia has some good information and emulators for other Nokia models as well, here: <a href="http://forum.nokia.com/030/1,32009,,00.html?fsrParam=2%2D0">http://forum.nokia.com/030/1,32009,,00.html?fsrParam=2%2D0</a> [incidently if you want to use one of the emulators you will also need to download the Nokia Mobile Internet Kit]. And YoSpace (<a href="http://www.yospace.com/cgi-bin/login.pl">http://www.yospace.com/cgi-bin/login.pl</a>) has a more all purpose wap emulator covering a variety of WAP enabled devices. Another simple and easy to use emulator can be found on pyweb site (<a href="http://www.pyweb.com/tools/">http://www.pyweb.com/tools/</a>) and is called Deck-It. This emulator emulates the Nokia 7110.</p>

<p>Now that you have your tools downloaded and installed, let's turn to the script. Since i develop mainly in Cold Fusion and PHP I have included both sets of scripts. Essentially what I did was look at strings passed by the browser or emulator. And based on a string evaluation I direct the user to the appropriate set of pages. In the case of WAP you are looking at the cgi variable generated by the web server called <strong>HTTP_ACCEPT</strong> and it should contain the following information: <strong><em>text/vnd.wap.wml</em></strong>. If a web browser hits the site these are the values contained in the variable:</p>

<p><strong>HTTP_ACCEPT</strong>=image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, application/x-gsarcade-launch, */*</p>

<p>After all this info here is the code, PHP first. Include the code below, right at the top of your site's default document:</p>

<p><pre>&lt;?php
  /*
      Browser detection script
  */
  if(eregi("text/vnd.wap.wml",$HTTP_ACCEPT)) { // wap first
    // Is a wap enabled device
    header("Location: wml/index.php");
  } else if(eregi("Liberate",$HTTP_USER_AGENT)) { // normal browsers next
    // It's the Liebrate emulator
    header("Location: itv/index.php");
  } else if(eregi("Mozilla/",$HTTP_USER_AGENT)) { // normal browsers next
    // It's web browser
    header("Location: html/index.php");
  } else {
    echo("Sonething all together different: ".$HTTP_ACCEPT."&lt;br /&gt;".$HTTP_USER_AGENT);
  }
?&gt;</pre></p>

<p>We make use of the <strong>eregi()</strong> function, which carries out a case insensitive regular expression match on, in this case, <strong>$HTTP_ACCEPT</strong> looking for the expression <strong><em>text/vnd.wap.wml</em></strong>. If found the user is re-directed using the <strong>header()</strong> function. For completeness I have included the other browser type re-directions (Liberate and Mozilla) or a dump of the variables to help detect the browser type</p>

<p>And now for Cold Fusion.</p>

<p><pre>&lt;cfif cgi.HTTP_ACCEPT contains "text/vnd.wap.wml"&gt;
  &lt;cflocation url="wml/index.cfm"&gt;
&lt;cfelseif cgi.HTTP_USER_AGENT contains "Mozilla/"&gt;
  &lt;cflocation url="html/index.cfm"&gt;
&lt;cfelseif cgi.HTTP_USER_AGENT contains "Liberate"&gt;
  &lt;cflocation url="itv/index.cfm"&gt;
&lt;cfelse&gt;
  &lt;cfloop collection="#cgi#" item="i"&gt;
    &lt;cfoutput&gt;#i# is #cgi[i]# &lt;/cfoutput&gt; &lt;br /&gt;
  &lt;/cfloop&gt;
&lt;/cfif&gt;</pre></p>

<p>As with the PHP script I make use of a function to find an expression. Here I made use of <strong>contains()</strong> inspected both the <strong>HTTP_ACCEPT</strong> and <strong>HTTP_USER_AGENT</strong> variables in the <strong><em>cgi</em></strong> scope. if found the browser or device is re-directed to the appropriate folder.</p>

<p>Now for certain devices or emulators (the Nokia one in my case), you need to either specify a file with the <strong><em>.wml</em></strong> extension or specify a content type in the header. NOw if you intend on using dynamic content using the <strong><em>.wml</em></strong> is not ideal as you won't be able to execute the scripts you write unless you associate that file type with PHP or Cold Fusion instructing the application server to parse it before sending it to the browser (the segment on <a href="http://gregs.teacupinastorm.com/html/article/article.php?id=9E04466F-F09C-4417-8B15679FF5F5052D">How to create IIS mappings for .cfm</a> has some hints on how to do that).</p>

<p>Cold Fusion allows you to easily specify a document content type by making use of the <strong>&lt;cfcontent&gt;</strong> tag as shown below:</p>

<p><pre>&lt;CFCONTENT TYPE="text/vnd.wap.wml"&gt;

&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE wml PUBLIC "-//PHONE.COM//DTD WML 1.1//EN" "http://www.phone.com/dtd/wml11.dtd" &gt;

&lt;wml&gt;

&lt;card id="WML" title="Test WML re-direct"&gt;
&lt;p&gt;
Just trying a a server based re-direct. &lt;br /&gt;
Cold fusion first.
&lt;cfloop collection="#cgi#" item="i"&gt;
    &lt;cfoutput&gt;#i# is #cgi[i]#&lt;/cfoutput&gt;&lt;br /&gt;
&lt;/cfloop&gt;
&lt;/p&gt;
&lt;/card&gt;

&lt;/wml&gt;</pre></p>

<p>For PHP I found the following solution at <a href="http://www.zend.com/zend/tut/wap.php#Heading7">Building WML Applications Using PHP</a> (there's also heaps more information there):</p>

<p><pre>
&lt;?php
// send wml headers
header("Content-type: text/vnd.wap.wml");
echo "&lt;?xml version=\"1.0\"?&gt;";
echo "&lt;!DOCTYPE wml PUBLIC \"-//WAPFORUM//DTD WML 1.1//EN\""
   . " \"http://www.wapforum.org/DTD/wml_1.1.xml\"&gt;";
?&gt;

&lt;wml&gt;
&lt;card id="card1" title="Example 1"&gt;
  &lt;p&gt;
    &lt;?php
// format and output date
    $the_date = date("M d Y");
    print $the_date;
    print "&lt;br/&gt;Welcome to a PHP-enabled site!";
    ?&gt;
  &lt;/p&gt;
&lt;/card&gt;
&lt;/wml&gt;
</pre></p>

<p>And there you are a wap enabled device will now be re-directed to the appropriate folder and presented with a message displaying the current server date and time. In the case of Cold Fusion I simply output all the variables in the <strong><em>cgi</em></strong> scope. There you go step 1 complete.</p>
